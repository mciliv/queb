#!/bin/bash

# Automatic test runner with change detection
# Usage: ./test-watch [unit|integration|all]

TEST_TYPE=${1:-unit}

echo "ğŸ§ª Starting automatic test runner..."
echo "ğŸ“ Watching: backend/, frontend/, test/"
echo "ğŸ¯ Test type: $TEST_TYPE"
echo ""

case $TEST_TYPE in
  "unit")
    echo "ğŸ”„ Running unit tests on file changes..."
    exec npx nodemon \
      --watch backend/ \
      --watch frontend/ \
      --ext js \
      --ignore test/ \
      --ignore node_modules/ \
      --delay 500ms \
      --exec "npm run test:unit"
    ;;
  "integration") 
    echo "ğŸ”„ Running integration tests on file changes..."
    exec npx nodemon \
      --watch backend/ \
      --watch frontend/ \
      --watch test/integration/ \
      --ext js \
      --ignore node_modules/ \
      --delay 1000ms \
      --exec "npm run test:integration"
    ;;
  "all")
    echo "ğŸ”„ Running all tests on file changes..."
    exec npx nodemon \
      --watch backend/ \
      --watch frontend/ \
      --watch test/ \
      --ext js,html,css \
      --ignore node_modules/ \
      --delay 1000ms \
      --exec "npm test"
    ;;
  *)
    echo "âŒ Invalid test type: $TEST_TYPE"
    echo "Usage: $0 [unit|integration|all]"
    exit 1
    ;;
esac 