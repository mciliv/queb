#!/bin/bash

set -e

# Get project root
PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$PROJECT_ROOT"

echo "ðŸš€ Starting Development Server"

# Clean up any existing processes
./cleanup 2>/dev/null || true

# Start the Node.js backend server
PORT=3001 NODE_ENV=development npx nodemon --quiet backend/api/server.js &
BACKEND_PID=$!

# Wait for backend to start
sleep 2

# Start Vite dev server for frontend
npx vite &
VITE_PID=$!

# Store PIDs for cleanup
echo $BACKEND_PID > /tmp/dev_backend_pid
echo $VITE_PID > /tmp/dev_vite_pid

echo "âœ… Development servers running:"
echo "   ðŸŒŸ https://dev.queb.space"
echo "   âš¡ Vite HMR enabled"

# Wait for either process to exit, then cleanup
wait $BACKEND_PID $VITE_PID

# Cleanup when either process exits
kill $BACKEND_PID 2>/dev/null || true
kill $VITE_PID 2>/dev/null || true
