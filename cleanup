#!/bin/bash

# Load shared colors and logging functions
source infrastructure/scripts/colors.sh

log_clean "Cleaning up all development processes and ports..."

# Kill all Node.js processes related to our project
pkill -f "node.*backend/api/server.js" 2>/dev/null || true
pkill -f "nodemon.*backend/api/server.js" 2>/dev/null || true
pkill -f "npm.*nodemon" 2>/dev/null || true

# Kill any remaining nodemon processes
pkill -f "nodemon" 2>/dev/null || true

# Try to free up the common ports
if command -v lsof >/dev/null 2>&1; then
  for port in 3000 3001 3002; do
    pids=$(lsof -ti:$port 2>/dev/null || true)
    if [ ! -z "$pids" ]; then
      log_info "ðŸ”„ Freeing port $port (PIDs: $pids)..."
      echo "$pids" | xargs kill -9 2>/dev/null || true
    fi
  done
fi

# Wait a moment for processes to fully terminate
sleep 1

log_success "Cleanup complete. You can now restart the server." 