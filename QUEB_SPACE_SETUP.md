# Queb.Space Setup Guide

This guide covers setting up both `queb.space` (Google Cloud production) and `dev.queb.space` (local development) environments.

## Quick Start

```bash
# 1. Run the setup script
./setup-queb-space.sh

# 2. Check status
./status-queb-space

# 3. Start local development
./dev-queb-space

# 4. Deploy to production
./deploy-queb-space
```

## Environment Overview

### Local Development (dev.queb.space)
- **URL**: https://dev.queb.space
- **Purpose**: Local development and testing
- **SSL**: Built-in HTTPS server with auto-generated certificates
- **HTTP**: http://localhost:3000 (standard Node.js port)
- **HTTPS**: https://localhost:3001 (alternative to 3000)
- **Browser-sync**: http://localhost:3002 (live reload - auto-detects app port)
- **Start**: `./dev-queb-space`

### Production (queb.space)
- **URL**: https://queb.space
- **Purpose**: Live production environment
- **Platform**: Google Cloud Functions
- **SSL**: Google-managed certificates
- **Deploy**: `./deploy-queb-space`

## Setup Process

### 1. Initial Setup

Run the comprehensive setup script:

```bash
./setup-queb-space.sh
```

Choose from:
- **Option 1**: Local development only
- **Option 2**: Google Cloud only  
- **Option 3**: Both environments
- **Option 4**: Check current status

### 2. Environment Configuration

The setup creates a `.env` file with:

```bash
# Queb.Space Environment Configuration
NODE_ENV=development
PORT=8080

# OpenAI API (Required for molecular analysis)
OPENAI_API_KEY=your_openai_api_key_here

# Database Configuration
DB_HOST=localhost
DB_PORT=5432
DB_NAME=mol_users
DB_USER=mol_user
DB_PASSWORD=mol_password

# Google Cloud Configuration
GOOGLE_CLOUD_PROJECT=molecular-analysis
FUNCTION_NAME=molecular-analysis
FUNCTION_TARGET=molecularAnalysis

# Payment Configuration
PAYMENTS_ENABLED=false
PAYMENTS_DEV_MODE=true
PAYMENTS_REQUIRED=false

# Development Configuration
INTEGRATION_TEST=false
```

**Important**: Update `OPENAI_API_KEY` with your actual API key.

### 3. Local Development Setup

The local setup includes:

- **SSL Certificates**: Auto-generated by the built-in HTTPS server
- **Hosts File**: `dev.queb.space` → `127.0.0.1`
- **Dependencies**: Automatic installation of missing packages
- **Port Management**: Automatic port selection and conflict resolution

### 4. Google Cloud Setup

The production setup includes:

- **Project Configuration**: `molecular-analysis` project
- **API Enablement**: Cloud Functions, Cloud Build, DNS, Run
- **DNS Zone**: `queb-space-zone` for queb.space
- **Cloud Function**: `molecular-analysis` function
- **Domain Mappings**: queb.space and www.queb.space

## Usage

### Local Development

```bash
# Start local development server
./dev-queb-space

# Access at: https://dev.queb.space
```

### Production Deployment

```bash
# Deploy to Google Cloud
./deploy-queb-space

# Access at: https://queb.space
```

### Status Monitoring

```bash
# Check both environments
./status-queb-space
```

## Domain Configuration

### Local Development (dev.queb.space)

The setup automatically:
1. Adds `127.0.0.1 dev.queb.space` to `/etc/hosts`
2. Installs missing dependencies (like `connect-livereload`)
3. Uses the built-in HTTPS server with auto-generated certificates
4. Manages port conflicts automatically

### Production (queb.space)

For production domain setup:

1. **DNS Zone**: Created in Google Cloud DNS
2. **Nameservers**: Update your domain registrar (Namecheap) with Google Cloud nameservers
3. **Domain Verification**: Complete in Google Search Console
4. **Domain Mappings**: Automatically created during deployment

## Troubleshooting

### Local Development Issues

**SSL Certificate Errors**:
```bash
# Certificates are auto-generated by the server
# Restart the server to regenerate
./cleanup && ./dev-queb-space
```

**Server Not Starting**:
```bash
# Check for missing dependencies
npm install connect-livereload

# Check port conflicts
lsof -i :3000
lsof -i :3001
lsof -i :3002
```

**Host Resolution Issues**:
```bash
# Check /etc/hosts
grep dev.queb.space /etc/hosts

# Add manually if missing
echo "127.0.0.1 dev.queb.space" | sudo tee -a /etc/hosts
```

### Google Cloud Issues

**Authentication**:
```bash
# Login to Google Cloud
gcloud auth login

# Set project
gcloud config set project molecular-analysis
```

**Function Deployment**:
```bash
# Check function status
gcloud functions describe molecular-analysis --region=us-central1

# View logs
gcloud functions logs read molecular-analysis --region=us-central1
```

**Domain Issues**:
```bash
# Check DNS zone
gcloud dns managed-zones describe queb-space-zone

# Check domain mappings
gcloud beta run domain-mappings list --region=us-central1
```

## File Structure

```
mol/
├── setup-queb-space.sh          # Main setup script
├── dev-queb-space              # Local development starter
├── deploy-queb-space           # Production deployment
├── status-queb-space           # Status checker
├── .env                        # Environment configuration
├── nginx-dev.conf             # nginx configuration
├── backend/api/certs/         # SSL certificates
│   ├── cert.pem
│   └── key.pem
└── infrastructure/
    ├── cloud/gcloud-func-toolkit/  # Google Cloud utilities
    └── deployment/                 # Deployment scripts
```

## Commands Reference

| Command | Purpose |
|---------|---------|
| `./setup-queb-space.sh` | Initial setup for both environments |
| `./dev-queb-space` | Start local development server |
| `./deploy-queb-space` | Deploy to Google Cloud production |
| `./status-queb-space` | Check status of both environments |
| `./cleanup` | Stop all development processes |

## Next Steps

1. **Update API Key**: Set your `OPENAI_API_KEY` in `.env`
2. **Test Local**: Run `./dev-queb-space` and visit https://dev.queb.space
3. **Deploy Production**: Run `./deploy-queb-space` when ready
4. **Monitor**: Use `./status-queb-space` to check both environments

## Support

For issues:
1. Check status: `./status-queb-space`
2. Review logs: `gcloud functions logs read molecular-analysis --region=us-central1`
3. Re-run setup: `./setup-queb-space.sh` 