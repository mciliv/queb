#!/bin/bash

# Automatic version detection and addition
# Analyzes current commit and suggests/adds appropriate version

echo "ğŸ¤– Automatic Version Detection"
echo "==============================="

node -e "
const AutoVersioning = require('./test/support/auto-versioning');
const autoVersioning = new AutoVersioning();

try {
    console.log('ğŸ” Analyzing current commit...');
    console.log('');
    
    // Show all suggestions
    const suggestions = autoVersioning.suggestVersionNames();
    console.log('ğŸ’¡ Version name suggestions:');
    Object.entries(suggestions).forEach(([type, name]) => {
        console.log(\`  \${type.padEnd(12)}: \${name}\`);
    });
    console.log('');
    
    // Auto-add the best suggestion (combined)
    console.log('âœ¨ Auto-adding version with combined naming...');
    const version = autoVersioning.addCurrentVersion({ 
        useCommitNumber: false, // Use combined by default
        useSemantic: false 
    });
    
    console.log(\`âœ… Added version: \${version.name}\`);
    console.log(\`ğŸ“ Description: \${version.description}\`);
    console.log(\`ğŸ”— Commit: \${version.gitCommit.substring(0, 8)}\`);
    console.log(\`ğŸŒ¿ Branch: \${version.gitBranch}\`);
    console.log('');
    
    console.log('ğŸ“Š Quick commands:');
    console.log(\`  ./compare-versions \${version.name} main\`);
    console.log('  ./list-versions');
    console.log('');
    
} catch (error) {
    console.error('âŒ Auto-versioning failed:', error.message);
    process.exit(1);
}
"
