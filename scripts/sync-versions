#!/bin/bash

# Sync versions from git history automatically
# Useful for populating version registry from existing commits

echo "ğŸ”„ Syncing Versions from Git History"
echo "===================================="

COUNT=${1:-10}  # Default to last 10 commits

echo "ğŸ“š Analyzing last $COUNT commits..."
echo ""

node -e "
const AutoVersioning = require('./test/support/auto-versioning');
const autoVersioning = new AutoVersioning();

try {
    // Add versions from git history
    console.log('ğŸ“‹ Adding versions from git history...');
    const versions = autoVersioning.addVersionsFromHistory($COUNT, { 
        useCommitNumber: true 
    });
    
    console.log(\`âœ… Added \${versions.length} versions from history\`);
    console.log('');
    
    // Also add major versions
    console.log('ğŸ¯ Adding major feature versions...');
    const majorVersions = autoVersioning.addMajorVersions({ 
        useCommitNumber: true 
    });
    
    console.log(\`âœ… Added \${majorVersions.length} major versions\`);
    console.log('');
    
    console.log('ğŸ“Š Version registry populated!');
    console.log('');
    console.log('ğŸ’¡ Next steps:');
    console.log('  ./list-versions                    # See all versions');
    console.log('  ./compare-versions <v1> <v2>       # Compare any two');
    console.log('  npm run test:versions <v1> <v2>    # Test in parallel');
    console.log('');
    
} catch (error) {
    console.error('âŒ Version sync failed:', error.message);
    process.exit(1);
}
"
