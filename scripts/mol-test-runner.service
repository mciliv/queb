[Unit]
Description=Mol Test Runner Service
Documentation=https://github.com/mciliv/mol
After=network.target

[Service]
Type=simple
User=node
WorkingDirectory=/opt/mol
Environment="NODE_ENV=production"
Environment="PATH=/usr/bin:/usr/local/bin"
Environment="OPENAI_API_KEY=test-api-key-for-testing"

# Main test scheduler process
ExecStart=/usr/bin/node /opt/mol/scripts/test-scheduler.js

# Restart configuration
Restart=always
RestartSec=10
StartLimitInterval=300
StartLimitBurst=5

# Process management
KillMode=mixed
KillSignal=SIGTERM
TimeoutStopSec=30

# Resource limits
MemoryLimit=1G
CPUQuota=50%

# Security hardening
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/opt/mol/logs /opt/mol/sdf_files /opt/mol/.git

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=mol-test-runner

[Install]
WantedBy=multi-user.target