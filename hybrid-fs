#!/bin/bash

# Hybrid File System - Simple Implementation
# Usage: ./hybrid-fs <command> <path> [content]

COMMAND="$1"
PATH_ARG="$2"
CONTENT="$3"

case "$COMMAND" in
  "create")
    # Create a hybrid file/directory
    # The file contains the main content
    # The directory (same name + .d) contains related files
    echo "$CONTENT" > "$PATH_ARG"
    mkdir -p "${PATH_ARG}.d"
    echo "‚úÖ Created hybrid: $PATH_ARG (file) + ${PATH_ARG}.d/ (directory)"
    ;;
    
  "read")
    # Read the main content
    if [ -f "$PATH_ARG" ]; then
      cat "$PATH_ARG"
    else
      echo "‚ùå File $PATH_ARG not found"
    fi
    ;;
    
  "ls")
    # List both file content info and directory contents
    if [ -f "$PATH_ARG" ]; then
      echo "üìÑ File content ($(wc -l < "$PATH_ARG" | tr -d ' ') lines):"
      head -3 "$PATH_ARG"
      echo "..."
    fi
    
    if [ -d "${PATH_ARG}.d" ]; then
      echo ""
      echo "üìÅ Related files in ${PATH_ARG}.d/:"
      ls -la "${PATH_ARG}.d"
    fi
    ;;
    
  "add")
    # Add a file to the hybrid's directory
    FILENAME="$3"
    FILECONTENT="$4"
    mkdir -p "${PATH_ARG}.d"
    echo "$FILECONTENT" > "${PATH_ARG}.d/$FILENAME"
    echo "‚úÖ Added $FILENAME to ${PATH_ARG}.d/"
    ;;
    
  "tree")
    # Show the hybrid structure
    if [ -f "$PATH_ARG" ]; then
      echo "üå≥ $PATH_ARG (hybrid)"
      echo "‚îú‚îÄ‚îÄ üìÑ content: $(wc -l < "$PATH_ARG" | tr -d ' ') lines"
      if [ -d "${PATH_ARG}.d" ]; then
        echo "‚îî‚îÄ‚îÄ üìÅ ${PATH_ARG}.d/"
        cd "${PATH_ARG}.d" && find . -type f | sed 's/^/    ‚îú‚îÄ‚îÄ /'
      fi
    fi
    ;;
    
  *)
    echo "Hybrid File System - Simple Implementation"
    echo ""
    echo "Usage: $0 <command> <path> [args...]"
    echo ""
    echo "Commands:"
    echo "  create <path> <content>     - Create hybrid file/dir"
    echo "  read <path>                 - Read main content"
    echo "  ls <path>                   - List file + directory contents"
    echo "  add <path> <filename> <content> - Add file to hybrid directory"
    echo "  tree <path>                 - Show hybrid structure"
    echo ""
    echo "Example:"
    echo "  $0 create App.jsx 'function App() { return <div>Hello</div>; }'"
    echo "  $0 add App.jsx App.test.jsx 'test content'"
    echo "  $0 add App.jsx App.css '.app { color: blue; }'"
    echo "  $0 tree App.jsx"
    ;;
esac
